<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon"
        href="data:image/svg+xml;utf8,<svg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2064'><rect%20fill='%23ffffff'%20width='64'%20height='64'/><circle%20cx='32'%20cy='32'%20r='30'%20fill='%23FF9900'/><text%20x='32'%20y='42'%20font-family='Arial,Helvetica,sans-serif'%20font-size='36'%20font-weight='700'%20fill='%23ffffff'%20text-anchor='middle'>A</text></svg>' />
    <title>@@INDEX_TITLE@@ (Compact)</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedcolumns/4.3.0/css/fixedColumns.dataTables.min.css" />
    <style>
        :root { --max-width: 1200px; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; max-width: var(--max-width); margin: 12px auto; padding: 12px; background:#f6f8fa; font-size:12px }
        h1 { color:#24292f; border-bottom:2px solid #0969da; padding-bottom:8px; font-size:18px }
        .controls { margin:8px 0; display:flex; gap:6px; align-items:center; flex-wrap:wrap }
        .panel{ background:#fff; border:1px solid #d0d7de; border-radius:6px; margin:10px 0; overflow:hidden }
        .panel-header{ padding:10px 12px; display:flex; justify-content:space-between; align-items:center }
        .panel-title{ font-weight:600; color:#0969da; font-size:13px }
        .panel-body{ padding:6px 12px; display:none }
        .table-container{ width:100%; overflow:auto }
        table{ border-collapse:collapse; width:100%; font-size:12px }
        th, td{ border:1px solid #e1e4e8; padding:4px 6px; text-align:left }
        th{ background:#f6f8fa }
        table.dataTable tbody td { white-space:pre-wrap; overflow-wrap:break-word; min-width:80px; max-width:300px }
        .cell-content.collapsed{ max-height:6em; overflow:hidden; cursor:pointer }
        .cell-content.collapsed::after{ content:"... (click to expand)"; display:block; position:absolute; bottom:0; right:0; background:linear-gradient(to right, transparent, #fff 50%); padding:0 8px 0 30px; color:#0969da; font-style:italic; font-size:11px }
        /* FixedColumns styling */
        .DTFC_LeftWrapper table th,
        .DTFC_LeftWrapper table td,
        .DTFC_LeftBodyWrapper table td,
        .DTFC_LeftHeadWrapper table th { border-color: #e1e4e8 !important; background: #fff !important; }
        body[data-theme="dark"] .DTFC_LeftWrapper table th,
        body[data-theme="dark"] .DTFC_LeftWrapper table td,
        body[data-theme="dark"] .DTFC_LeftBodyWrapper table td,
        body[data-theme="dark"] .DTFC_LeftHeadWrapper table th { background:#0b1f2d !important; color:#cbd5e1 !important; border-color:#1f2d38 !important; }
        .btn{ background:#0969da; color:#fff; border:none; padding:5px 8px; border-radius:4px; cursor:pointer }
        .btn.secondary{ background:#fff; color:#0969da; border:1px solid #cbd5e1 }
        .global-filter{ margin-left:8px; padding:5px 6px; border-radius:6px; border:1px solid #cbd5e1 }
        /* compact list */
        body.list-view .table-container{ display:none }
        .list-container{ display:none; padding:6px 0 }
        .list-container.active{ display:block }
        .list-card{ border:1px solid #e1e4e8; padding:8px; margin-bottom:6px; border-radius:6px; background:#fff }
        .card-row{ display:flex; gap:8px; padding:3px 0 }
        .card-key{ font-weight:600; width:160px; color:#0969da; font-size:12px }
        .card-value{ white-space:pre-wrap; word-break:break-word; font-size:12px }
        /* Theme variants */
        body[data-theme="dark"]{
            background:#0b1220;
            color:#cbd5e1;
        }
        body[data-theme="dark"] .panel{ background:#071224; border-color:#123; }
        body[data-theme="dark"] th{ background:#081426; color:#cbd5e1 }
        body[data-theme="dark"] .btn{ background:#0b6bd6 }

        body[data-theme="compact"]{ font-size:12px; --max-width:1200px; }
        body[data-theme="compact"] th, body[data-theme="compact"] td{ padding:4px 6px; font-size:12px }
        /* Dark theme: ensure list cards are dark and text is readable */
        body[data-theme="dark"] .list-container { background: transparent }
        body[data-theme="dark"] .list-card { background: #071224; border-color: #123; }
        body[data-theme="dark"] .card-key { color: #9cc3ff }
        body[data-theme="dark"] .card-value { color: #cbd5e1 }
    </style>
</head>

<body data-theme="compact">
    <h1>@@INDEX_TITLE@@ (Compact)</h1>
    <p class="description">@@INDEX_DESCRIPTION@@</p>

    <div class="controls">
        <label for="panelFilter">Filter:</label>
        <input id="panelFilter" class="global-filter" placeholder="hide categories by name" />
        <a id="downloadAll" class="btn secondary" href="resources/@@OUTPUT_FILE@@" download style="margin-right:8px">Download</a>
        <button id="expandAll" class="btn">Expand</button>
        <button id="collapseAll" class="btn">Collapse</button>
        <button id="wordWrap" class="btn">Word wrap</button>
        <select id="designSelect" class="global-filter">
            <option value="compact">Compact</option>
            <option value="default">Default</option>
            <option value="dark">Dark</option>
        </select>
        <button id="toggleView" class="btn secondary">List View</button>
    </div>

    <div id="content"></div>
    <div class="meta">Generated: <span id="generated"></span></div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.min.js" crossorigin="anonymous"></script>

    <script>
        // Compact template JS: lightweight loader + list/table toggle
        const ViewState = { columnsLocked:false, wordWrapEnabled:true, wideViewActive:false, viewMode:'table' };
        function setViewMode(mode){ ViewState.viewMode = mode; if(mode==='list'){ document.body.classList.add('list-view'); document.getElementById('toggleView').textContent='Table View'; document.querySelectorAll('.list-container').forEach(c=>c.classList.add('active')); } else { document.body.classList.remove('list-view'); document.getElementById('toggleView').textContent='List View'; document.querySelectorAll('.list-container').forEach(c=>c.classList.remove('active')); } TableManager.applyToAllTables((api,table)=>{ TableManager.adjustColumnsWithRelayout(api); }); }

        // Minimal ButtonController & TableManager are defined inline for compact template
        class ButtonController{ constructor(buttonId){ this.button=document.getElementById(buttonId); this.state=false; this.trueLabel=""; this.falseLabel=""; this.isPrimaryWhenTrue=true } setLabel(label,isPrimary=true){ if(!this.button) return; if(isPrimary) this.button.classList.remove('secondary'); else this.button.classList.add('secondary'); this.button.textContent=label } init(initialState,trueLabel,falseLabel,isPrimaryWhenTrue=true){ this.state=initialState; this.trueLabel=trueLabel; this.falseLabel=falseLabel; this.isPrimaryWhenTrue=isPrimaryWhenTrue; this.setLabel(this.state?trueLabel:falseLabel, this.state?isPrimaryWhenTrue:!isPrimaryWhenTrue) } toggle(){ this.state=!this.state; this.setLabel(this.state?this.trueLabel:this.falseLabel, this.state?this.isPrimaryWhenTrue:!this.isPrimaryWhenTrue); return this.state } onClick(callback){ if(!this.button) return; this.button.addEventListener('click',()=>{ const newState=this.toggle(); callback(newState); }) } }

        class TableManager{ static applyToAllTables(callback){ document.querySelectorAll("table.dataTable").forEach((table)=>{ if($.fn.dataTable.isDataTable(table)){ try{ callback($(table).DataTable(), table); }catch(e){ console.warn("applyToAllTables callback error", e) } } }) } static isTableReady(api){ try{ const settings = api.settings(); return settings && settings[0] && !!settings[0]._bInitComplete }catch(e){ return false } } static adjustColumns(api){ try{ api.columns.adjust().draw(false); window.dispatchEvent(new Event('resize')) }catch(e){ console.warn('adjustColumns error', e) } } static adjustColumnsWithRelayout(api){ this.adjustColumns(api); try{ if(api && api.fixedColumns) api.fixedColumns().relayout() }catch(e){} } static getTableApi(containerElement){ try{ const tableNode = containerElement.querySelector('table'); if(tableNode && $.fn.dataTable.isDataTable(tableNode)) return $(tableNode).DataTable() }catch(e){ console.warn('getTableApi error', e) } return null } static applyFixedColumns(api, table, enable){ if(!this.isTableReady(api)) return; const isEnabled = $(table).data('fixedColumnsEnabled'); if(enable && !isEnabled){ try{ if(api && api.fixedColumns){ api.fixedColumns().left(3); $(table).data('fixedColumnsEnabled', true) } }catch(e){ console.error('Failed to enable FixedColumns:', e) } } else if(!enable && isEnabled){ try{ if(api && api.fixedColumns){ api.fixedColumns().left(0); $(table).data('fixedColumnsEnabled', false) } }catch(e){ console.error('Failed to disable FixedColumns:', e) } } this.adjustColumns(api) } }

        // helpers for expand/collapse used by UI
        TableManager.expandPanel = function(item){
            try{
                if(!item || !item.body || !item.btnToggle) return;
                item.body.style.display = 'block';
                item.btnToggle.textContent = 'Collapse';
                const api = TableManager.getTableApi(item.body);
                if(api) TableManager.adjustColumnsWithRelayout(api);
            }catch(e){ console.warn('expandPanel error', e); }
        };

        TableManager.collapsePanel = function(item){
            try{
                if(!item || !item.body || !item.btnToggle) return;
                item.body.style.display = 'none';
                item.btnToggle.textContent = 'Expand';
            }catch(e){ console.warn('collapsePanel error', e); }
        };

        async function loadAndRender(){ try{ const content=document.getElementById('content'); const resp = await fetch('files.json'); if(!resp.ok){ content.innerText='Failed to load files.json'; return } const files = await resp.json(); const items=[]; for(const f of files){ const panel=document.createElement('div'); panel.classList.add('panel'); const header=document.createElement('div'); header.classList.add('panel-header'); const title=document.createElement('div'); title.classList.add('panel-title'); title.textContent = f.display_name || f.path; const actions=document.createElement('div'); const btnToggle=document.createElement('button'); btnToggle.textContent='Expand'; btnToggle.classList.add('btn'); actions.appendChild(btnToggle); header.appendChild(title); header.appendChild(actions); const body=document.createElement('div'); body.classList.add('panel-body'); panel.appendChild(header); panel.appendChild(body); content.appendChild(panel);

            btnToggle.addEventListener('click', async ()=>{ if(body.dataset.loading==='1') return; const isCollapsed = body.style.display==='none' || body.style.display===""; if(isCollapsed){ body.style.display='block'; if(!body.dataset.loaded){ btnToggle.textContent='Loading...'; body.dataset.loading='1'; try{ const r = await fetch(f.path); if(!r.ok){ body.textContent='Failed to load '+f.path; body.dataset.loaded=true; body.dataset.loading='0'; btnToggle.textContent='Collapse'; return } const txt = await r.text(); if(typeof txt !== 'string') throw new Error('Invalid CSV content'); if(txt.trim()==='') throw new Error('CSV file is empty'); const parsed = Papa.parse(txt,{ header:true, skipEmptyLines:true }); if(parsed.errors && parsed.errors.length>0){ console.warn('PapaParse warnings', parsed.errors); if(parsed.errors.some(error=>error.type==='Delimiter' || error.type==='Quotes')) throw new Error('CSV parsing failed: '+ parsed.errors.map(e=>e.message).join('; ')) } const rows = parsed.data || []; const fields = parsed.meta && parsed.meta.fields ? parsed.meta.fields : rows.length ? Object.keys(rows[0]) : []; const tableContainer=document.createElement('div'); tableContainer.classList.add('table-container'); const table=document.createElement('table'); table.classList.add('data-table','dataTable'); table.setAttribute('width','100%'); const listContainer=document.createElement('div'); listContainer.classList.add('list-container'); if(ViewState.viewMode==='list') listContainer.classList.add('active'); if(fields.length>0){ const thead=document.createElement('thead'); const trh=document.createElement('tr'); for(const h of fields){ const th=document.createElement('th'); th.textContent=h; trh.appendChild(th) } thead.appendChild(trh); table.appendChild(thead); const tbody=document.createElement('tbody'); for(const row of rows){ const tr=document.createElement('tr'); for(const h of fields){ const td=document.createElement('td'); const contentVal = row[h] ?? ''; const lineCount = contentVal.split('\n').length; if(lineCount>=7){ const wrapper=document.createElement('div'); wrapper.classList.add('cell-content','collapsed'); wrapper.textContent = contentVal; wrapper.addEventListener('click', function(e){ e.stopPropagation(); if(this.classList.contains('collapsed')){ this.classList.remove('collapsed'); this.classList.add('expanded'); } else { this.classList.remove('expanded'); this.classList.add('collapsed'); } }); td.appendChild(wrapper); } else { td.textContent = contentVal; } if(!ViewState.wordWrapEnabled) td.classList.add('no-wrap'); tr.appendChild(td) } tbody.appendChild(tr); const card=document.createElement('div'); card.classList.add('list-card'); for(const h of fields){ const rowWrap=document.createElement('div'); rowWrap.classList.add('card-row'); const k=document.createElement('div'); k.classList.add('card-key'); k.textContent = h; const v=document.createElement('div'); v.classList.add('card-value'); v.textContent = row[h] ?? ''; rowWrap.appendChild(k); rowWrap.appendChild(v); card.appendChild(rowWrap); } listContainer.appendChild(card); } table.appendChild(tbody); }

                tableContainer.appendChild(table); body.appendChild(tableContainer); body.appendChild(listContainer); await new Promise(resolve=>setTimeout(resolve,50)); const dt=$(table).DataTable({ scrollX:true, pageLength:50, lengthMenu:[10,25,50,100], deferRender:true, processing:true, autoWidth:false, fixedColumns:{left:4}, columnDefs:[{targets:0, visible:false}] }); $(table).data('fixedColumnsEnabled', false); if(ViewState.columnsLocked) TableManager.applyFixedColumns(dt, table, true); TableManager.adjustColumnsWithRelayout(dt); body.dataset.loaded='1'; body.dataset.loading='0'; btnToggle.textContent='Collapse'; } catch(e){ body.textContent = 'Failed to load CSV: '+e; body.dataset.loaded=true; body.dataset.loading='0'; btnToggle.textContent='Expand' } } else { const api = TableManager.getTableApi(body); if(api) TableManager.adjustColumnsWithRelayout(api); } } else { TableManager.collapsePanel({body, btnToggle}); } });

            items.push({ panel, header, body, btnToggle, file: f }); }

        document.getElementById('generated').textContent = new Date().toUTCString(); const wordWrapBtn = new ButtonController('wordWrap'); const wideViewBtn = new ButtonController('wideView'); const lockColumnsBtn = new ButtonController('lockColumns');

        const designSelect = document.getElementById('designSelect'); if(designSelect){ designSelect.addEventListener('change', ()=>{ const v = designSelect.value || 'compact'; if(v==='default') document.body.removeAttribute('data-theme'); else document.body.setAttribute('data-theme', v); TableManager.applyToAllTables((api,table)=>{ TableManager.adjustColumnsWithRelayout(api); }); }); }

        const toggleViewBtn = document.getElementById('toggleView'); if(toggleViewBtn){ toggleViewBtn.addEventListener('click', ()=>{ setViewMode(ViewState.viewMode==='table' ? 'list' : 'table'); }); }

        document.getElementById('expandAll').addEventListener('click', ()=>{ items.forEach((it)=>{ if(!it.body.dataset.loaded) it.btnToggle.click(); else TableManager.expandPanel(it); }); });
        document.getElementById('collapseAll').addEventListener('click', ()=>{ items.forEach((it)=>{ TableManager.collapsePanel(it); }); });

        wordWrapBtn.init(ViewState.wordWrapEnabled, 'Disable wrap', 'Enable wrap', true); wordWrapBtn.onClick((newState)=>{ ViewState.wordWrapEnabled = newState; document.querySelectorAll('table.dataTable tbody td').forEach((td)=>{ if(ViewState.wordWrapEnabled) td.classList.remove('no-wrap'); else td.classList.add('no-wrap'); }); TableManager.applyToAllTables((api,table)=>{ TableManager.adjustColumnsWithRelayout(api); }); });

        const panelFilter = document.getElementById('panelFilter'); panelFilter.addEventListener('input', ()=>{ const q = panelFilter.value.trim().toLowerCase(); items.forEach((it)=>{ const name = (it.file.display_name || it.file.path || '').toLowerCase(); if(q==='' || name.includes(q)) it.panel.style.display='block'; else it.panel.style.display='none'; }); });

        wideViewBtn.init(ViewState.wideViewActive, 'Wide view', 'Normal view', true); wideViewBtn.onClick((newState)=>{ ViewState.wideViewActive = newState; const root = document.documentElement; if(ViewState.wideViewActive) root.style.setProperty('--max-width','1400px'); else root.style.setProperty('--max-width','1200px'); });

        lockColumnsBtn.init(ViewState.columnsLocked, 'Unlock columns', 'Lock to Name', false); lockColumnsBtn.onClick((newState)=>{ ViewState.columnsLocked = newState; TableManager.applyToAllTables((api,table)=>{ TableManager.applyFixedColumns(api, table, ViewState.columnsLocked); }); });

        const downloadBtn = document.getElementById('downloadAll'); if(downloadBtn){ downloadBtn.addEventListener('click', async (e)=>{ e.preventDefault(); const url = downloadBtn.getAttribute('href') || 'resources/all.csv'; try{ const r = await fetch(url); if(!r.ok){ alert('Failed to download '+url); return } const blob = await r.blob(); const filename = url.split('/').pop() || 'all.csv'; const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href); }catch(err){ alert('Download failed: '+err); } }); }

        try{ const urlParams = new URLSearchParams(window.location.search); const paramAuto = urlParams.get('autoExpand')==='1' || urlParams.get('autoExpand')==='true'; const autoCheckbox = document.getElementById('autoExpandCheckbox'); if(autoCheckbox && paramAuto) autoCheckbox.checked = true; const doAutoExpand = ()=>{ const enabled = paramAuto || (autoCheckbox && autoCheckbox.checked); if(!enabled) return; setTimeout(()=>{ const panels=document.querySelectorAll('.panel'); for(let i=0;i<Math.min(panels.length,3);i++){ const btn = panels[i].querySelector('.panel-header button'); if(btn) btn.click(); } },200); }; doAutoExpand(); if(autoCheckbox) autoCheckbox.addEventListener('change', ()=>{ if(autoCheckbox.checked) doAutoExpand(); }); }catch(e){}

        setViewMode(ViewState.viewMode);
        } catch (e) {
            console.error('loadAndRender error', e);
        }
        }

        window.addEventListener('load', loadAndRender);
    </script>
</body>

</html>
